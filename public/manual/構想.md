# Repo Observer - プロジェクト構想

> このドキュメントは、プロジェクトの構想と背景を記録したものです。
> 実装状況と最新の使い方については [README.md](../../README.md) を参照してください。

## 概要

GitHubのリポジトリを管理し、一つのIssueに一つのリポジトリを紐づけます。それをGitHub Projectsのダッシュボードでステータスやラベルで現状を可視化します。

---

## 🎯 目標の最終形

あなたのやりたい構成は次の通り：

| 要素       | 内容                                                     |
| -------- | ------------------------------------------------------ |
| **管理対象** | KenichiroAraiユーザーの全リポジトリ（自動取得、最大100件）                  |
| **管理場所** | 専用の「管理リポジトリ」（repo-dashboard）                           |
| **表現方法** | 各リポジトリ = 1つのIssue（タイトル＝リポジトリ名）                         |
| **可視化**  | GitHub Projects（ボードやテーブル）でステータスを表示                     |
| **更新方法** | GitHub Actionsで毎日自動的に各リポジトリの情報を取得し、Issueを自動更新（手動実行も可能） |
| **目的**   | どのリポジトリが活発か／放置されているかを一目で把握する                           |

---

## 🧩 構成イメージ

```text
repo-observer (管理リポジトリ)
├── .github/workflows/repo-full-sync.yml
├── Project (Dashboard)
└── Issues
    ├── repo-A 状況
    ├── repo-B 状況
    └── repo-C 状況
```

GitHub Projectでは下のようなダッシュボードを構築：

| リポジトリ  | Stars | Forks | Open Issues | 最終Push       | ステータス       |
| ------ | ----- | ----- | ----------- | ------------ | ------------ |
| repo-A | ⭐ 24  | 🍴 8   | 🐞 3        | ⏰ 2025-11-05 | 頻繁に更新      |
| repo-B | ⭐ 5   | 🍴 2   | 🐞 0        | ⏰ 2025-10-15 | 定期的に更新     |
| repo-C | ⭐ 12  | 🍴 3   | 🐞 1        | ⏰ 2025-08-20 | 時々更新       |
| repo-D | ⭐ 3   | 🍴 0   | 🐞 0        | ⏰ 2024-12-01 | 停滞中        |

---

## ⚙️ 実装ステップ

### ① 専用リポジトリ作成

例: `kenichiro-arai/repo-observer`

### ② Secretの登録（オプション）

**基本的には不要です。** ワークフローでは自動的に提供される `GITHUB_TOKEN` を使用します。

**GitHub Project連動を利用する場合:**

Personal Access Token (Classic) を作成し、リポジトリの Secrets に `PROJECT_TOKEN` として登録します。

詳細は [README.md](../../README.md#2-シークレットの設定オプション) を参照してください。

### ③ GitHub Actions ワークフロー

`.github/workflows/repo-full-sync.yml` が自動実行されます。

**主な機能:**

- 毎日自動実行（UTC 18:00 = JST 3:00）または手動実行
- CSV出力とIssue同期を1回の実行で完了
- 手動実行時に `run_issue_sync=false` を指定するとIssue同期ジョブのみをスキップできる

ジョブ依存関係やパラメータの詳細は [ワークフロー同期制御.md](ワークフロー同期制御.md) を参照してください。

### ④ 初回手動実行

GitHub → Actions → 「リポジトリ情報同期」 → "Run workflow"

詳細な実行方法は [README.md](../../README.md#5-ワークフローの実行) を参照してください。

### ⑤ Projectで可視化

1. 「Projects」 → 「New project」 → **Table view**
2. ステータスフィールド「Status」を追加
3. ワークフローで自動的にIssueがProjectに追加されます
4. **Project番号が誤っていると `sync-issues` ジョブが失敗** するため、URL末尾の番号を再確認してください（存在しない番号を指定するとエラーで停止し、完了通知でも失敗が分かるようになっています）

詳細は [README.md](../../README.md#3-github-projectの準備オプション) を参照してください。

---

## 💡 発展例と実装状況

| 機能 | 説明 | 実装状況 |
|-----|------|---------|
| **CSV出力** | リポジトリ情報をCSVファイルに出力 | ✅ 実装済 |
| **Issue同期** | 各リポジトリを1つのIssueとして同期 | ✅ 実装済 |
| **Project連動** | GraphQL APIを使用してProjectに自動追加・ステータス更新 | ✅ 実装済 |
| **5段階ステータス判定** | 経過日数に応じて詳細なステータスを自動判定 | ✅ 実装済 |
| **詳細情報の取得** | リポジトリの説明、言語、ライセンス、トピックス、リリース情報など | ✅ 実装済 |
| **柔軟な実行** | 手動実行時にIssue同期のON/OFFを切り替え可能 (`run_issue_sync`) | ✅ 実装済 |
| **対象ユーザー指定** | 手動実行時に対象ユーザーを指定 | ✅ 実装済 |
| **フィルタリング** | プライベート/アーカイブリポジトリの除外 | ✅ 実装済 |
| **セカンダリレート制限対策** | 自動リトライ機能（指数バックオフ） | ✅ 実装済 |
| ラベルでステータス管理 | Issueに活動状況ラベルを自動付与 | 🔲 未実装 |
| Stars数増減通知 | 前回の値と比較して通知 | 🔲 未実装 |
| Slack通知 | Slack連携でメッセージ送信 | 🔲 未実装 |
| JSON出力 | API連携用のJSON形式での出力 | 🔲 未実装 |

---

## ✅ まとめ

| 要素 | 内容 |
|-----|------|
| **各リポジトリ → 1 Issue** | ✅ 実装済 |
| **CSV出力** | ✅ 毎日自動実行 + 手動実行可能 |
| **定期更新（自動反映）** | ✅ GitHub Actions（毎日 18:00 UTC） |
| **可視化** | ✅ GitHub Projects Table + CSV |
| **状態判断** | ✅ 最終Push日とIssue更新日から自動分類（5段階） |
| **柔軟性** | ✅ 手動実行時にIssue同期のON/OFFを指定可能 |
| **メンテナンス性** | ✅ 高い（TypeScriptスクリプトの共通化） |

実装の詳細については [README.md](../../README.md) を参照してください。

---

## 📚 関連ドキュメント

詳細な実装状況と使い方については、以下のドキュメントを参照してください：

- **[README.md](../../README.md)** - プロジェクトの概要と基本的な使い方
- **[ワークフロー同期制御.md](ワークフロー同期制御.md)** - ワークフローの詳細仕様と運用方法
- **[.github/scripts/repo-full-sync/README.md](../../.github/scripts/repo-full-sync/README.md)** - スクリプトの技術仕様とローカル実行方法
